#!/usr/bin/env bash

# Instructions:
# 1. Make this bash script available on your PATH
# 2. Add the following to your [final] LaTeX after the preamble:
#\makeatletter
#\immediate\write18{generate-bib "\@shortauthor" "\@shorttitle" "\@spvolume" "\@sparticle" "\@spyear" "\@splastpage" "\@pdfkeywords" > sp.\@spvolume.\@sparticle.bib}
#\makeatother
# 3. Recompile!

# $1     $2    $3     $4     $5   $6       $7
# Author Title Volume Number Year LastPage Keywords

# replace ', and ' with ' and '
AUTHOR=${1//, and / and }
# replace ',' with ' and'
AUTHOR=${AUTHOR//,/ and}
# $AUTHOR should now have all authors properly separated by ' and ', as BibTeX expects

# replace ' and ' with '+' and split into an array on the '+' character
IFS='+' read -a AUTHORS <<< ${AUTHOR// and /+}
# the string operator `##* ` greedy-deletes everything up until the last space for each argument in the array,
# while the simultaneous IFS + [*] explosion joins each string with the '-' character
IFS='-' NAMESTRING=${AUTHORS[*]##* }
# the string operator `,,` lowercases everything
CITEKEY=${NAMESTRING,,}-$5

cat <<EOS
@article{$CITEKEY,
	Author = {$AUTHOR},
	Title = {$2},
	Journal = {Semantics and Pragmatics},
	Volume = {$3},
	Number = {$4},
	Month = {November},
	Pages = {1--$6},
	DOI = {10.3765/sp.$3.$4},
	Keywords = {$7},
	Year = {$5}}
EOS
